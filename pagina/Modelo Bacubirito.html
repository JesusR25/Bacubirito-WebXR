<html>
    <head>
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <title>Bacubirito</title>
        <script type="text/javascript" src="/js/jsqrscanner.nocache.js"></script>
        <script type="text/javascript" src="/js/marcadores/modbacu.js"></script>
        <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
        <script src="https://hammerjs.github.io/dist/hammer.min.js"></script>
        <script>
            AFRAME.registerComponent("controller", {
                init: function () {
                    this.modelVisible = true;
                    // track markerFound/markerLost
                    // grab the model reference
                    document.querySelector("[gltf-model]").addEventListener("model-loaded", evt => {
                        this.mesh = evt.detail.model
                    })
                    // hammerjs input helper
                    const hammertime = new Hammer(document.body);

                    // scale
                    // scale is tricky, because it resets
                    var currentScale = 1;
                    hammertime.get('pinch').set({ enable: true });
                    hammertime.on("pinchstart", (ev) => {
                        currentScale = this.mesh.scale.x;
                    })
                    hammertime.on("pinchmove", (ev) => {
                        if (!this.modelVisible) return;
                        this.mesh.scale.multiplyScalar(0).addScalar(ev.scale * currentScale);
                    });

                    // rotation
                    // pan left/right for rotation
                    this.isPanning = false;
                    hammertime.on("panleft", () => {
                        if (!this.modelVisible) return;
                        this.isPanning = true
                        this.mesh.rotation.y -= 4 * Math.PI / 360;
                    })

                    hammertime.on("panright", () => {
                        if (!this.modelVisible) return;
                        this.isPanning = true
                        this.mesh.rotation.y += 4 * Math.PI / 360;
                    })

                    hammertime.on("panup", () => {
                        if (!this.modelVisible) return;
                        this.isPanning = true
                        this.mesh.rotation.x -= 4 * Math.PI / 360;
                    })

                    hammertime.on("pandown", () => {
                        if (!this.modelVisible) return;
                        this.isPanning = true
                        this.mesh.rotation.x += 4 * Math.PI / 360;
                    })


                    hammertime.on("panend", () => this.isPanning = false)
                    hammertime.on("pancancel", () => this.isPanning = false)

                    hammertime.on("swipeleft", ({ velocity }) => {
                        if (!this.modelVisible) return;
                        this.swipeVelocity = velocity
                    })
                    hammertime.on("swiperight", ({ velocity }) => {
                        if (!this.modelVisible) return;
                        this.swipeVelocity = velocity
                    })
                    
                },
                tick: function () {
                    if (!(this.modelVisible && this.swipeVelocity && !this.isPanning)) return;
                    this.mesh.rotation.y += this.swipeVelocity * 4 * Math.PI / 360;
                    this.swipeVelocity *= 0.93;
                    if (Math.abs(this.swipeVelocity) <= 0.1) this.swipeVelocity = 0;
                }
            })
        </script>
        <style>
            .qrscanner video {
            position: fixed;
            right: 0;
            bottom: 0;
            min-width: 100%;
            min-height: 100%;
            background-size: cover;
            height: auto;
            width: auto;
        }
        .butt {
            background: url(../assets/Imagenes/btn2.png) center;
            border: none;
            color: #F1EA41;
            padding: 7px;
            text-align: center;
            text-decoration: none;
            display: inline-block;
            font-size: 12px;
            margin: 4px 2px;
            cursor: pointer;
            border-radius: 12px;
            border: 2px solid rgba(235, 152, 78);
            box-shadow: 0 8px 16px 0 rgba(0, 0, 0, 0.2), 0 6px 20px 0 rgba(0, 0, 0, 0.19);
        }
        </style>

    </head>

    <body style='margin : 5px; overflow: hidden; font-family: Monospace;'>
        <div class="qrscanner" id="scanner"></div>
        <div id="botonesorigen" style='position: absolute; bottom: 2%; left: 25%; text-align: center; z-index: 1;'>
            <button class="butt" id="btn7">Menu Principal</button>
            <button class="butt" id="btn8">Ocultar</button>
            <button class="butt" id="btn9">Mostrar</button>
        </div>
        <script>
            document.getElementById("btn7").addEventListener("click", (e) => {
                window.history.back();
            });
            document.getElementById("btn9").addEventListener("click", (e) => {
                document.querySelector("#modelo").emit("acercar");
            });
            document.getElementById("btn8").addEventListener("click", (e) => {
                document.querySelector("#modelo").emit("foo");
            });
        </script>
        <a-scene vr-mode-ui="enabled: false" id="escena" loading-screen="enabled: false;"
            arjs='sourceType: webcam; debugUIEnabled: false;' id="scene" embedded controller>
            <a-assets>
                <a-asset-item id="bacu" src="../assets/Bacubirito/MeteoM.glb"></a-asset-item>
            </a-assets>
            <a-entity id="modelo" visible="true" position="0 0 -4" rotation="45 0 0" scale="2 2 2" gltf-model="#bacu" animation="property: scale; to: 0 0 0; dur: 3000; easing: linear; startEvents: foo;" animation__2="property: scale; to: 2 2 2; dur: 3000; easing: linear; startEvents: acercar;"></a-entity>
            <a-marker id="meteo" type='pattern' url='../assets/MarcadoresF/pattern-Meteorito.patt'>
                <!-- we use cors proxy to avoid cross-origin problems ATTENTION! you need to set up your server -->
            </a-marker>
    

            <a-entity camera></a-entity>
        </a-scene>
    </body>
</html>