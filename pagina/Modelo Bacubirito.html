<html>
    <head>
        <meta name="apple-mobile-web-app-capable" content="yes">
        <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
        <title>Bacubirito</title>
        <script src="https://aframe.io/releases/1.3.0/aframe.min.js"></script>
        <script src="https://raw.githack.com/AR-js-org/AR.js/master/aframe/build/aframe-ar.js"></script>
        <script src="https://hammerjs.github.io/dist/hammer.min.js"></script>
        <script>
            AFRAME.registerComponent("controller", {
            init: function () {
                // hammerjs input helper
                const hammertime = new Hammer(document.body);
                // scale
                // scale is tricky, because it resets
                var currentScale = 1;
                hammertime.get('pinch').set({ enable: true });
                hammertime.on("pinchstart", (ev) => {
                    currentScale = this.mesh.scale.x;
                })
                // scale
                // scale is tricky, because it resets
                var currentScale = 1;
                hammertime.get('pinch').set({ enable: true });
                hammertime.on("pinchstart", (ev) => {
                    currentScale = this.mesh.scale.x;
                })

                 // rotation
                // pan left/right for rotation
                this.isPanning = false;
                hammertime.on("panleft", () => {
                    this.isPanning = true
                    this.mesh.rotation.y -= 4 * Math.PI / 360;
                })

                hammertime.on("panright", () => {
                    this.isPanning = true
                    this.mesh.rotation.y += 4 * Math.PI / 360;
                })
                hammertime.on("panend", () => this.isPanning = false)
                hammertime.on("pancancel", () => this.isPanning = false)

                hammertime.on("swipeleft",  ({velocity}) => {
                    this.swipeVelocity = velocity
                })
                hammertime.on("swiperight", ({velocity}) => {
                    this.swipeVelocity = velocity
                })
            },
            tick: function() {
                if (!(this.swipeVelocity &&!this.isPanning)) return;
                this.mesh.rotation.y += this.swipeVelocity * 4 * Math.PI / 360;
                this.swipeVelocity *= 0.93;
                if (Math.abs(this.swipeVelocity) <= 0.1) this.swipeVelocity = 0;
            }
        })
        </script>
    </head>

    <body style='margin : 5px; overflow: hidden; font-family: Monospace;'>
        </div>
        <a-scene vr-mode-ui="enabled: false" id="escena" loading-screen="enabled: false;" arjs='sourceType: webcam; debugUIEnabled: false;' id="scene" embedded>
            <a-assets>
                <a-asset-item id="bacu" src="../assets/Bacubirito/Terminado.glb"></a-asset-item>
            </a-assets>
            <a-entity id="modelo" visible="true" position="0 0 -4" rotation="0 0 0" scale="0.5 0.5 0.5" gltf-model="#bacu" ></a-entity>
            <a-marker id="meteo" type='pattern' url='../assets/MarcadoresF/pattern-Meteorito.patt' controller>
            </a-marker>
            <a-entity camera></a-entity>
            </a-scene>    
    </body>
</html>